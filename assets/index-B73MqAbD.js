(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))h(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&h(a)}).observe(document,{childList:!0,subtree:!0});function i(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function h(e){if(e.ep)return;e.ep=!0;const s=i(e);fetch(e.href,s)}})();class u{constructor(t,i,h,e,s,a="white"){this.game=t,this.x=i,this.y=h,this.width=4,this.height=10,this.speed=e,this.direction=s,this.color=a,this.markedForDeletion=!1}update(){this.y+=this.speed*this.direction,(this.y<0||this.y>this.game.height)&&(this.markedForDeletion=!0)}draw(t){t.fillStyle=this.color,this.color==="red"?(t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height/2,this.width,0,Math.PI*2),t.fill()):t.fillRect(this.x,this.y,this.width,this.height)}}class c{constructor(t){this.game=t,this.width=50,this.height=30,this.x=this.game.width*.5-this.width*.5,this.y=this.game.height-this.height-10,this.speed=5,this.maxSpeed=10,this.vx=0,this.projectiles=[],this.shootTimer=0,this.shootInterval=20}update(t){t.includes("ArrowRight")?this.vx=this.speed:t.includes("ArrowLeft")?this.vx=-this.speed:this.vx=0,this.x+=this.vx,this.x<0&&(this.x=0),this.x>this.game.width-this.width&&(this.x=this.game.width-this.width),this.shootTimer>0&&this.shootTimer--,t.includes(" ")&&this.shootTimer===0&&(this.shoot(),this.shootTimer=this.shootInterval)}shoot(){this.game.projectiles.push(new u(this.game,this.x+this.width*.5-2,this.y,10,-1)),this.game.sound.playShoot()}draw(t){t.fillStyle="#00ffff";const i=["00000100000","00001110000","00001110000","01101110110","11111111111","11111111111","11111111111","11000000011"],h=this.width/11;for(let e=0;e<8;e++)for(let s=0;s<11;s++)i[e][s]==="1"&&t.fillRect(this.x+s*h,this.y+e*h,h,h)}}class p{constructor(){this.keys=new Set,window.addEventListener("keydown",t=>{this.keys.add(t.key)}),window.addEventListener("keyup",t=>{this.keys.delete(t.key)})}isDown(t){return this.keys.has(t)}}class m{constructor(t,i,h){this.game=t,this.x=i,this.y=h,this.width=40,this.height=30,this.markedForDeletion=!1,this.frame=0}update(t,i){this.x+=t,this.y+=i,(t!==0||i!==0)&&(this.frame=this.frame===0?1:0)}draw(t){t.fillStyle="#00ff00";const h=[["00100000100","00010001000","00111111100","01101110110","11111111111","10111111101","10100000101","00011011000"],["00100000100","10010001001","10111111101","11101110111","11111111111","00111111100","00100000100","01000000010"]][this.frame],e=this.width/11;for(let s=0;s<8;s++)for(let a=0;a<11;a++)h[s][a]==="1"&&t.fillRect(this.x+a*e,this.y+s*e,e,e)}}class y{constructor(){this.ctx=new(window.AudioContext||window.webkitAudioContext),this.enabled=!0}resume(){this.ctx.state==="suspended"&&this.ctx.resume()}suspend(){this.ctx.state==="running"&&this.ctx.suspend()}playTone(t,i,h){if(!this.enabled)return;const e=this.ctx.createOscillator(),s=this.ctx.createGain();e.type=i,e.frequency.setValueAtTime(t,this.ctx.currentTime),s.gain.setValueAtTime(.1,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+h),e.connect(s),s.connect(this.ctx.destination),e.start(),e.stop(this.ctx.currentTime+h)}playShoot(){if(!this.enabled)return;const t=this.ctx.createOscillator(),i=this.ctx.createGain();t.type="square",t.frequency.setValueAtTime(880,this.ctx.currentTime),t.frequency.exponentialRampToValueAtTime(110,this.ctx.currentTime+.1),i.gain.setValueAtTime(.1,this.ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),t.connect(i),i.connect(this.ctx.destination),t.start(),t.stop(this.ctx.currentTime+.1)}playExplosion(){if(!this.enabled)return;const t=this.ctx.sampleRate*.2,i=this.ctx.createBuffer(1,t,this.ctx.sampleRate),h=i.getChannelData(0);for(let a=0;a<t;a++)h[a]=Math.random()*2-1;const e=this.ctx.createBufferSource();e.buffer=i;const s=this.ctx.createGain();s.gain.setValueAtTime(.2,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.2),e.connect(s),s.connect(this.ctx.destination),e.start()}playMove(t){const i=[180,170,160,150];this.playTone(i[t%4],"square",.05)}playLevelClear(){if(!this.enabled)return;const t=this.ctx.currentTime;this.playToneAt(523.25,t,.1),this.playToneAt(659.25,t+.1,.1),this.playToneAt(783.99,t+.2,.1),this.playToneAt(1046.5,t+.3,.4)}playGameOver(){if(!this.enabled)return;const t=this.ctx.currentTime;this.playToneAt(329.63,t,.3),this.playToneAt(261.63,t+.3,.3),this.playToneAt(220,t+.6,.3),this.playToneAt(185,t+.9,1)}playToneAt(t,i,h){const e=this.ctx.createOscillator(),s=this.ctx.createGain();e.type="square",e.frequency.setValueAtTime(t,i),s.gain.setValueAtTime(.1,i),s.gain.exponentialRampToValueAtTime(.01,i+h),e.connect(s),s.connect(this.ctx.destination),e.start(i),e.stop(i+h)}startBGM(){!this.enabled||this.isPlayingBGM||(this.isPlayingBGM=!0,this.beatCount=0,this.tempo=180,this.secondsPerBeat=60/this.tempo,this.nextNoteTime=this.ctx.currentTime,this.schedule())}schedule(){if(this.isPlayingBGM){for(;this.nextNoteTime<this.ctx.currentTime+.1;)this.playBeat(this.nextNoteTime,this.beatCount),this.nextNoteTime+=this.secondsPerBeat/2,this.beatCount++;this.timerID=requestAnimationFrame(this.schedule.bind(this))}}playBeat(t,i){const h=[130.81,130.81,98,98,110,110,87.31,87.31],e=i%16,s=h[Math.floor(e/4)%4];if(e%2===1&&this.playBass(s,t,.1),e%2===0){const a=[261.63,293.66,329.63,349.23,392,440,493.88,523.25],r=a[Math.floor(Math.random()*a.length)];this.playTone(r,"triangle",.1)}e%4===0&&this.playKick(t),e%2===1&&this.playHihat(t)}playBass(t,i,h){const e=this.ctx.createOscillator(),s=this.ctx.createGain();e.type="sawtooth",e.frequency.setValueAtTime(t,i);const a=this.ctx.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(800,i),s.gain.setValueAtTime(.1,i),s.gain.exponentialRampToValueAtTime(.01,i+h),e.connect(a),a.connect(s),s.connect(this.ctx.destination),e.start(i),e.stop(i+h)}playKick(t){const i=this.ctx.createOscillator(),h=this.ctx.createGain();i.frequency.setValueAtTime(150,t),i.frequency.exponentialRampToValueAtTime(.01,t+.5),h.gain.setValueAtTime(.5,t),h.gain.exponentialRampToValueAtTime(.01,t+.5),i.connect(h),h.connect(this.ctx.destination),i.start(t),i.stop(t+.5)}playHihat(t){const i=this.ctx.sampleRate*.05,h=this.ctx.createBuffer(1,i,this.ctx.sampleRate),e=h.getChannelData(0);for(let o=0;o<i;o++)e[o]=Math.random()*2-1;const s=this.ctx.createBufferSource();s.buffer=h;const a=this.ctx.createBiquadFilter();a.type="highpass",a.frequency.value=5e3;const r=this.ctx.createGain();r.gain.setValueAtTime(.1,t),r.gain.exponentialRampToValueAtTime(.01,t+.05),s.connect(a),a.connect(r),r.connect(this.ctx.destination),s.start(t)}stopBGM(){this.isPlayingBGM=!1,this.timerID&&cancelAnimationFrame(this.timerID)}startUFOAlert(){if(!this.enabled||this.ufoOsc)return;this.ufoOsc=this.ctx.createOscillator(),this.ufoGain=this.ctx.createGain(),this.ufoOsc.type="sawtooth",this.ufoOsc.frequency.setValueAtTime(400,this.ctx.currentTime),this.ufoOsc.frequency.linearRampToValueAtTime(800,this.ctx.currentTime+.1),this.ufoOsc.frequency.linearRampToValueAtTime(400,this.ctx.currentTime+.2);const t=this.ctx.createOscillator();t.type="sine",t.frequency.value=8;const i=this.ctx.createGain();i.gain.value=200,t.connect(i),i.connect(this.ufoOsc.frequency),t.start(),this.ufoLFO=t,this.ufoGain.gain.value=.05,this.ufoOsc.connect(this.ufoGain),this.ufoGain.connect(this.ctx.destination),this.ufoOsc.start()}stopUFOAlert(){this.ufoOsc&&(this.ufoOsc.stop(),this.ufoOsc.disconnect(),this.ufoOsc=null),this.ufoLFO&&(this.ufoLFO.stop(),this.ufoLFO.disconnect(),this.ufoLFO=null),this.ufoGain&&(this.ufoGain.disconnect(),this.ufoGain=null)}playUFOExplosion(){if(!this.enabled)return;const t=this.ctx.sampleRate*.5,i=this.ctx.createBuffer(1,t,this.ctx.sampleRate),h=i.getChannelData(0);for(let r=0;r<t;r++)h[r]=Math.random()*2-1;const e=this.ctx.createBufferSource();e.buffer=i;const s=this.ctx.createGain();s.gain.setValueAtTime(.5,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.5);const a=this.ctx.createBiquadFilter();a.type="lowpass",a.frequency.setValueAtTime(500,this.ctx.currentTime),a.frequency.linearRampToValueAtTime(100,this.ctx.currentTime+.5),e.connect(a),a.connect(s),s.connect(this.ctx.destination),e.start()}}class g{constructor(t){this.game=t,this.width=60,this.height=30,this.x=-this.width,this.y=40,this.speed=3,this.markedForDeletion=!1,this.scoreValue=Math.floor(Math.random()*3+1)*100}update(){this.x+=this.speed,this.x>this.game.width&&(this.markedForDeletion=!0)}draw(t){t.fillStyle="red";const i=["0000011111100000","0001111111111000","0011111111111100","0110110110110110","1111111111111111","0011100110011100","0001000000001000","0000000000000000"],h=this.width/16;for(let e=0;e<8;e++)for(let s=0;s<16;s++)i[e][s]==="1"&&t.fillRect(this.x+s*h,this.y+e*h,h,h)}}class f{constructor(t,i,h,e,s){this.text=t,this.x=i,this.y=h,this.color=e,this.size=s,this.life=60,this.opacity=1,this.velocity=-2}update(){this.y+=this.velocity,this.life--,this.opacity=this.life/60}draw(t){t.save(),t.globalAlpha=this.opacity,t.fillStyle=this.color,t.font=`${this.size}px Arial`,t.fillText(this.text,this.x,this.y),t.restore()}}class T{constructor(t,i,h,e){this.game=t,this.x=i,this.y=h,this.color=e,this.size=Math.random()*3+2,this.speedX=Math.random()*6-3,this.speedY=Math.random()*6-3,this.life=100,this.markedForDeletion=!1}update(){this.x+=this.speedX,this.y+=this.speedY,this.size*=.95,this.life--,(this.life<=0||this.size<.5)&&(this.markedForDeletion=!0)}draw(t){t.save(),t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill(),t.restore()}}class w{constructor(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width=800,this.height=this.canvas.height=600,this.input=new p,this.sound=new y,this.player=new c(this),this.invaders=[],this.projectiles=[],this.floatingTexts=[],this.particles=[],this.score=0,this.highScore=0,this.level=1,this.paused=!1,this.gameOver=!1,this.levelClear=!1,this.levelClearTimer=0,this.enemyShootTimer=0,this.enemyShootInterval=3e3,this.ufo=null,this.ufoTimer=2e3,this.lastTime=0,this.screenShake=0,this.invaderSpeed=2,this.invaderDirection=1,this.invaderDrop=!1,this.initInvaders()}initInvaders(){for(let o=0;o<4;o++)for(let l=0;l<8;l++){const d=50+l*60,x=100+o*50;this.invaders.push(new m(this,d,x))}}update(t){if(this.input.keys.has("p")||this.input.keys.has("P")||this.input.keys.has("Escape")||this.input.keys.has("Pause")?this.pauseKeyDown||(this.paused=!this.paused,this.pauseKeyDown=!0,this.paused?this.sound.suspend():this.sound.resume()):this.pauseKeyDown=!1,this.paused)return;if(this.gameOver){this.input.keys.has("Enter")&&this.resetGame(),this.floatingTexts.forEach(e=>e.update()),this.floatingTexts=this.floatingTexts.filter(e=>e.life>0);return}if(this.levelClear){this.levelClearTimer-=t,this.levelClearTimer<=0&&this.nextLevel();return}const i=Array.from(this.input.keys);i.length>0&&(this.sound.resume(),this.sound.startBGM()),this.player.update(i),this.projectiles.forEach(e=>e.update()),this.projectiles=this.projectiles.filter(e=>!e.markedForDeletion),this.floatingTexts.forEach(e=>e.update()),this.floatingTexts=this.floatingTexts.filter(e=>e.life>0),this.particles.forEach(e=>e.update()),this.particles=this.particles.filter(e=>!e.markedForDeletion),this.screenShake>0&&this.screenShake--;let h=!1;if(this.invaders.forEach(e=>{e.update(this.invaderSpeed*this.invaderDirection,0),(e.x+e.width>this.width||e.x<0)&&(h=!0)}),this.enemyShootTimer-=t,this.enemyShootTimer<=0&&this.invaders.length>0){this.enemyShootTimer=this.enemyShootInterval-this.level*50,this.enemyShootTimer<200&&(this.enemyShootTimer=200);const e=this.invaders[Math.floor(Math.random()*this.invaders.length)];this.projectiles.push(new u(this,e.x+e.width/2,e.y+e.height,5,1,"red"))}this.ufo?(this.ufo.update(),this.ufo.markedForDeletion&&(this.ufo=null,this.sound.stopUFOAlert())):(this.ufoTimer-=t,this.ufoTimer<=0&&(this.ufo=new g(this),this.sound.startUFOAlert(),this.ufoTimer=Math.random()*1e4+5e3)),this.invaders.length>0&&this.invaders[0].x%10,h&&(this.invaderDirection*=-1,this.invaders.forEach(e=>{e.update(0,20)})),this.checkCollisions(),this.invaders.length===0&&(this.levelClear=!0,this.levelClearTimer=2e3,this.sound.playLevelClear()),this.invaders.forEach(e=>{e.y+e.height>=this.player.y&&(this.gameOver=!0,this.sound.stopBGM())})}checkCollisions(){this.projectiles.forEach(t=>{if(!t.markedForDeletion)if(t.direction===-1){for(const i of this.invaders)if(!i.markedForDeletion&&t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y){i.markedForDeletion=!0,t.markedForDeletion=!0,this.score+=100,this.score>this.highScore&&(this.highScore=this.score),this.sound.playExplosion();break}if(!t.markedForDeletion&&this.ufo&&!this.ufo.markedForDeletion&&t.x<this.ufo.x+this.ufo.width&&t.x+t.width>this.ufo.x&&t.y<this.ufo.y+this.ufo.height&&t.y+t.height>this.ufo.y){this.ufo.markedForDeletion=!0,t.markedForDeletion=!0;const i=[100,300,500,1e3],h=i[Math.floor(Math.random()*i.length)];this.score+=h,this.score>this.highScore&&(this.highScore=this.score),this.sound.playUFOExplosion(),this.screenShake=20;for(let e=0;e<50;e++)this.particles.push(new T(this,this.ufo.x+this.ufo.width/2,this.ufo.y+this.ufo.height/2,["red","orange","yellow","white"][Math.floor(Math.random()*4)]));this.floatingTexts.push(new f("BAAAM!!",this.ufo.x,this.ufo.y,"orange",30)),this.floatingTexts.push(new f(h.toString(),this.ufo.x+20,this.ufo.y+30,"yellow",20))}}else t.direction===1&&t.x<this.player.x+this.player.width&&t.x+t.width>this.player.x&&t.y<this.player.y+this.player.height&&t.y+t.height>this.player.y&&(this.gameOver=!0,this.sound.stopBGM(),this.sound.playGameOver())}),this.invaders=this.invaders.filter(t=>!t.markedForDeletion)}resetGame(){this.player=new c(this),this.invaders=[],this.projectiles=[],this.floatingTexts=[],this.particles=[],this.score=0,this.level=1,this.gameOver=!1,this.invaderSpeed=2,this.invaderDirection=1,this.initInvaders(),this.sound.startBGM()}nextLevel(){this.level++,this.levelClear=!1,this.invaderSpeed+=.5,this.invaders=[],this.projectiles=[],this.invaderDirection=1,this.initInvaders()}draw(){this.ctx.save(),this.screenShake>0&&this.ctx.translate(Math.random()*10-5,Math.random()*10-5),this.ctx.clearRect(0,0,this.width,this.height),this.player.draw(this.ctx),this.invaders.forEach(t=>t.draw(this.ctx)),this.ufo&&this.ufo.draw(this.ctx),this.projectiles.forEach(t=>t.draw(this.ctx)),this.particles.forEach(t=>t.draw(this.ctx)),this.floatingTexts.forEach(t=>t.draw(this.ctx)),this.ctx.restore(),this.drawUI()}drawUI(){this.ctx.fillStyle="white",this.ctx.font="20px Arial",this.ctx.fillText("Score: "+this.score,10,30),this.ctx.fillText("HI: "+this.highScore,150,30),this.ctx.fillText("Level: "+this.level,this.width-100,30),this.ctx.font="14px Arial",this.ctx.fillText("Press 'P' to Pause",20,this.height-20),this.ctx.save(),this.ctx.fillStyle="#00ff00",this.ctx.font="bold 30px Arial",this.ctx.textAlign="center",this.ctx.fillText("SPACE INVADER",this.width/2,40),this.ctx.restore(),this.levelClear&&(this.ctx.fillStyle="yellow",this.ctx.font="40px Arial",this.ctx.textAlign="center",this.ctx.fillText("LEVEL CLEARED!",this.width*.5,this.height*.5),this.ctx.textAlign="left"),this.gameOver&&(this.ctx.fillStyle="rgba(50, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="red",this.ctx.font="40px Arial",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.width*.5,this.height*.5),this.ctx.fillStyle="white",this.ctx.font="20px Arial",this.ctx.fillText("Press Enter to Restart",this.width*.5,this.height*.5+40),this.ctx.textAlign="left"),this.paused&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="white",this.ctx.font="40px Arial",this.ctx.textAlign="center",this.ctx.fillText("PAUSED",this.width*.5,this.height*.5),this.ctx.textAlign="left")}start(){this.loop(0)}loop(t){const i=t-this.lastTime;this.lastTime=t,this.update(i),this.draw(),requestAnimationFrame(this.loop.bind(this))}}window.addEventListener("DOMContentLoaded",()=>{console.log("Main.js: DOMContentLoaded");const n=document.getElementById("gameCanvas");new w(n).start()});
